# Topology (토폴로지)란?

## 📚 기본 개념

**Topology (토폴로지)**는 그래프의 **구조적 특성**을 분석하는 것을 의미합니다.

### 그래프 구조

```
그래프 G = (V, E, W, T)
- V: Vertices (노드, 주소들)
- E: Edges (엣지, 트랜잭션들)
- W: Weights (가중치, 거래 금액)
- T: Timestamps (시간)
```

### Topology 분석이란?

여러 노드(주소)와 엣지(거래) 간의 **관계와 구조**를 분석하는 것:

1. **경로(Path) 분석**: A → B → C → D 같은 체인 구조
2. **순환(Cycle) 탐지**: A → B → A 같은 순환 구조
3. **홉(Hop) 분석**: 몇 홉 떨어져 있는지
4. **연결성 분석**: 어떤 주소들이 연결되어 있는지

---

## 🎯 TRACE-X 룰에서의 Topology

### B-201: Layering Chain (레이어링 체인)

**의미**: 자금 세탁의 "레이어링" 단계에서 나타나는 패턴

**구조**:

```
A → B → C → D (3홉 이상)
- 같은 토큰으로 거래
- 각 홉의 금액 차이가 5% 이내 (자금을 숨기기 위해 비슷한 금액으로 이동)
```

**왜 Topology가 필요한가?**

- 단일 트랜잭션만 봐서는 알 수 없음
- 여러 거래를 그래프로 연결해서 경로를 찾아야 함
- NetworkX 같은 그래프 라이브러리 필요

### B-202: Cycle (순환)

**의미**: 자금의 출처를 모호하게 만들기 위한 순환 거래

**구조**:

```
A → B → A (2홉 순환)
또는
A → B → C → A (3홉 순환)
```

**왜 Topology가 필요한가?**

- 순환 구조를 찾으려면 그래프 전체를 봐야 함
- DFS/BFS 같은 그래프 탐색 알고리즘 필요

---

## 💡 MPOCryptoML과의 관계

MPOCryptoML 논문에서도 **구조적 패턴**을 탐지합니다:

- **Stack**: 방향성 경로 (directed path) = B-201과 유사
- **Bipartite**: 두 레이어 구조
- **Fan-in/Fan-out**: 연결 구조

이들은 모두 **그래프의 구조적 특성**을 분석하는 것입니다.

---

## 🛠️ 구현 방법

### 현재 상태

- ✅ `MPOCryptoMLPatternDetector.detect_stack_pattern()`: Stack 패턴 탐지 (B-201 활용 가능)
- ❌ `detect_cycle_pattern()`: 순환 탐지 (B-202 구현 필요)

### 필요한 것

1. **그래프 구축**: 트랜잭션 히스토리 → NetworkX 그래프
2. **경로 탐색**: DFS/BFS로 경로 찾기
3. **순환 탐지**: NetworkX의 순환 탐지 알고리즘
4. **토큰 필터링**: 같은 토큰으로만 거래한 경로만 고려
5. **금액 차이 계산**: 각 홉의 금액 변화율 계산

---

## 📋 요약

**Topology = 그래프 구조 분석**

- 단일 거래가 아닌 **여러 거래 간의 관계**를 분석
- **경로, 순환, 연결성** 등을 탐지
- 자금 세탁의 **레이어링, 구조화** 패턴 탐지에 필수
