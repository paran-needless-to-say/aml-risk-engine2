# 미구현 룰 요약 및 제외 가능성 분석

## 📋 미구현 룰 5개 요약

### 1️⃣ B-401, B-402, B-403A, B-403B: 주소 상태 관리 필요

#### B-401: First 7 Days Burst (첫 7일 급증)

- **목적**: 주소 생성 후 7일 내에 대량 거래하는 패턴 탐지
- **조건**:
  - 주소 나이 <= 7일
  - 첫 7일 총액 >= 10,000 USD
  - 첫 7일 거래 수 >= 3회
- **점수**: 20점 (MEDIUM)
- **필요한 것**: 주소 생성일(`first_seen_ts`) 추적, 첫 7일간 거래 집계

#### B-402: Reactivation (재활성화)

- **목적**: 오래된 주소가 장기간 비활성 후 갑자기 재활성화하는 패턴 탐지
- **조건**:
  - 주소 나이 >= 365일
  - 비활성 기간 >= 180일
  - 재활성 거래 금액 >= 1,000 USD
- **점수**: 15점 (LOW)
- **필요한 것**: 주소 생성일, 마지막 거래일 추적

#### B-403A: Lifecycle A — Young but Busy (젊지만 바쁨)

- **목적**: 30일 이내 주소가 매우 활발한 거래 패턴 탐지
- **조건**:
  - 주소 나이 <= 30일
  - 30일 내 거래 수 >= 100회
  - 30일 내 중간 금액 >= 100 USD
- **점수**: 10점 (LOW)
- **필요한 것**: 주소 나이, 30일간 거래 통계

#### B-403B: Lifecycle B — Old and Rare High Value (오래되었지만 드물게 고액)

- **목적**: 오래된 주소가 드물게 고액 거래하는 패턴 탐지
- **조건**:
  - 주소 나이 >= 365일
  - 총 거래 수 <= 10회
  - 총액 >= 50,000 USD
  - 중간 금액 >= 5,000 USD
- **점수**: 10점 (LOW)
- **필요한 것**: 주소 나이, 총 거래 통계

**공통 문제점**:

- 주소별 메타데이터 저장소 필요 (DB 또는 캐시)
- 주소 생성일, 마지막 거래일 추적 필요
- 시간 기반 집계 및 통계 계산 필요
- **구현 복잡도**: ⭐⭐⭐ (높음) - 1-2일 소요

---

### 2️⃣ B-501: High-Value Buckets (고액 버킷)

- **목적**: 거래 금액에 따라 동적으로 점수 할당
- **조건**:
  - 10,000 ~ 50,000 USD: 5점
  - 50,000 ~ 250,000 USD: 10점
  - 250,000 ~ 1,000,000 USD: 15점
  - > = 1,000,000 USD: 20점
- **점수**: 동적 (5~20점)
- **필요한 것**: 거래 금액에 따른 버킷 분류 및 동적 점수 할당
- **구현 복잡도**: ⭐⭐ (중간) - 반나절 소요
- **구현 방법**: `core/rules/evaluator.py`에서 `score: dynamic` 처리 로직 추가

---

### 3️⃣ B-502: Structuring Pattern (구조화 패턴)

- **목적**: 24시간 내 반올림된 금액으로 반복 송금하는 패턴 탐지 (구조화 의심)
- **조건**:
  - 24시간 내 출금 거래만
  - 거래 금액을 반올림해서 그룹화
  - 같은 반올림 금액으로 5회 이상 거래
  - 그룹별 총액 >= 10,000 USD
- **점수**: 10점 (LOW)
- **필요한 것**:
  - 반올림 값 계산
  - 값별 그룹화
  - 그룹별 집계 (count, sum)
  - 방향 필터링 (outgoing만)
- **구현 복잡도**: ⭐⭐ (중간) - 반나절 소요
- **구현 방법**: `core/aggregation/window.py`에 그룹화 로직 추가

---

## 🤔 제외 가능성 분석

### ✅ 제외해도 되는 룰 (복잡도 높음, 점수 낮음)

#### B-401, B-402, B-403A, B-403B (주소 상태 관리 룰)

- **제외 권장**: ✅
- **이유**:
  1. **구현 복잡도 높음**: 주소별 메타데이터 저장소 구축 필요 (DB/캐시)
  2. **점수 낮음**: 모두 LOW~MEDIUM (10~20점)
  3. **대체 가능**: 이미 구현된 룰들로 대부분 커버 가능
     - B-101 (Burst)로 급증 패턴 탐지 가능
     - C-003, C-004로 고액 거래 탐지 가능
     - B-102 (Rapid Sequence)로 활발한 거래 탐지 가능
  4. **데이터 의존성**: 주소 생성일 정보가 백엔드에서 제공되지 않으면 구현 불가

**결론**: 제외해도 됨. 이미 구현된 룰들로 충분히 커버 가능.

---

### 🤷 구현 고려 가능 (복잡도 중간, 유용함)

#### B-501: High-Value Buckets

- **제외 여부**: 선택적
- **이유**:
  1. **구현 난이도**: 중간 (반나절 소요)
  2. **유용성**: 거래 금액에 따른 세밀한 점수 할당 가능
  3. **하지만**: C-003 (High-Value Single Transfer)로 이미 고액 거래 탐지 가능
- **결론**: 구현해도 되고, 제외해도 됨. 우선순위 낮음.

#### B-502: Structuring Pattern

- **제외 여부**: 선택적
- **이유**:
  1. **구현 난이도**: 중간 (반나절 소요)
  2. **유용성**: 구조화 패턴은 AML에서 중요하지만, 점수 낮음 (10점)
  3. **하지만**: B-101, B-102로 반복 거래 패턴 탐지 가능
- **결론**: 구현해도 되고, 제외해도 됨. 우선순위 낮음.

---

## 📊 제외 시 영향 분석

### 현재 구현된 룰로 커버 가능한지

| 미구현 룰                             | 대체 가능한 구현된 룰                | 커버 가능 여부 |
| ------------------------------------- | ------------------------------------ | -------------- |
| **B-401** (첫 7일 급증)               | B-101 (Burst), C-003 (High-Value)    | ✅ 커버 가능   |
| **B-402** (재활성화)                  | C-003 (High-Value Single Transfer)   | ✅ 커버 가능   |
| **B-403A** (젊지만 바쁨)              | B-101, B-102 (Burst, Rapid Sequence) | ✅ 커버 가능   |
| **B-403B** (오래되었지만 드물게 고액) | C-003 (High-Value Single Transfer)   | ✅ 커버 가능   |
| **B-501** (고액 버킷)                 | C-003 (High-Value Single Transfer)   | ✅ 커버 가능   |
| **B-502** (구조화 패턴)               | B-101, B-102 (반복 거래 패턴)        | ✅ 커버 가능   |

---

## 💡 권장 사항

### 1. 제외 권장 (B-401, B-402, B-403A, B-403B)

- **이유**: 구현 복잡도 높음, 점수 낮음, 대체 가능
- **조치**: 룰북에서 제외하거나 주석 처리

### 2. 선택적 구현 (B-501, B-502)

- **B-501**: 구현 난이도 중간, 하지만 C-003으로 대체 가능
- **B-502**: 구현 난이도 중간, 하지만 B-101, B-102로 대체 가능
- **결론**: 시간이 있으면 구현, 없으면 제외해도 됨

---

## 🎯 최종 권장안

### 시나리오 1: 빠른 완성 (권장)

- **제외**: B-401, B-402, B-403A, B-403B, B-501, B-502 모두 제외
- **이유**: 이미 구현된 11개 룰로 충분히 커버 가능
- **구현 완료 룰**: 11개 (C-001, C-003, C-004, E-101, B-101, B-102, B-103, B-201, B-202, B-203, B-204)

### 시나리오 2: 선택적 구현

- **제외**: B-401, B-402, B-403A, B-403B (주소 상태 관리 룰)
- **구현**: B-501, B-502 (구현 난이도 중간, 반나절씩)
- **구현 완료 룰**: 13개

### 시나리오 3: 전체 구현

- **모두 구현**: 19개 룰 모두 구현
- **소요 시간**: 3-4일 추가 소요
- **구현 완료 룰**: 19개

---

## 📝 결론

**제외해도 되는 룰**:

- ✅ **B-401, B-402, B-403A, B-403B**: 구현 복잡도 높음, 점수 낮음, 대체 가능
- 🤷 **B-501, B-502**: 구현 난이도 중간, 하지만 대체 가능

**현재 구현된 11개 룰로도 충분히 효과적인 AML 스코어링 가능**
