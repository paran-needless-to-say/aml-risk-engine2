# 그래프 구조 분석의 한계와 해결 방안

## 🤔 핵심 질문

**"단일 주소에 한해서 스코어링하는데, 그래프 구조를 볼 수 있나?"**

---

## 📊 현재 상황 분석

### 현재 시스템 구조

```
주소 A 분석
  ↓
주소 A의 거래 히스토리만 받음
  - A → B (거래 1)
  - A → C (거래 2)
  - B → A (거래 3)  ← A가 받은 거래
```

### 문제점

**B-201 (Layering Chain)을 찾으려면:**

```
A → B → C → D (3홉 경로)
```

하지만 현재는:

- 주소 A의 거래만 봄
- A → B는 볼 수 있음 ✅
- B → C는? ❌ (B의 거래 히스토리가 없음)
- C → D는? ❌ (C의 거래 히스토리가 없음)

**결론**: 단일 주소의 거래만으로는 2홉 이상의 경로를 찾을 수 없음!

---

## 💡 해결 방안

### 방안 1: 백엔드에서 확장된 거래 데이터 제공 (추천)

**현재 API 입력**:

```json
{
  "address": "0xABC...",
  "transactions": [
    {"from": "0xABC", "to": "0xDEF", ...},
    {"from": "0xABC", "to": "0xGHI", ...}
  ]
}
```

**개선된 API 입력**:

```json
{
  "address": "0xABC...",
  "transactions": [
    // 직접 거래
    {"from": "0xABC", "to": "0xDEF", ...},
    // 1홉 거래 (0xDEF의 거래)
    {"from": "0xDEF", "to": "0xGHI", ...},
    {"from": "0xDEF", "to": "0xJKL", ...},
    // 2홉 거래 (0xGHI의 거래)
    {"from": "0xGHI", "to": "0xMNO", ...}
  ]
}
```

**장점**:

- 주소 분석 범위 확장 (1-2홉까지)
- B-201, B-202 룰 구현 가능
- 백엔드가 이미 데이터를 가지고 있을 가능성 높음

**단점**:

- 데이터 양 증가
- 백엔드 수정 필요

---

### 방안 2: 제한된 그래프 분석 (현실적)

**가능한 것**:

- **1홉 경로**: A → B (A의 거래에서)
- **역방향 1홉**: B → A (A가 받은 거래에서)
- **2홉 경로 (부분)**: A → B → ? (B의 거래는 모름)

**구현 예시**:

```python
# 주소 A의 거래에서
# A → B 거래 발견
# 그럼 B가 어디로 보냈는지 확인하려면...
# 하지만 B의 거래 히스토리가 없음!

# 대안: A가 받은 거래에서
# B → A 거래 발견
# 그럼 B가 어디서 왔는지 확인하려면...
# 하지만 B의 거래 히스토리가 없음!
```

**결론**: 1홉까지만 분석 가능, 2홉 이상은 불가능

---

### 방안 3: 백엔드에 추가 요청 (비추천)

**구현 방식**:

1. 주소 A 분석 시작
2. A의 거래에서 B, C 발견
3. 백엔드에 B, C의 거래 히스토리 요청
4. 그래프 구축

**문제점**:

- API 호출이 많아짐
- 성능 저하
- 복잡도 증가

---

## 🎯 현실적인 해결책

### B-201, B-202 룰의 현실적 구현

#### 옵션 A: 백엔드에서 확장 데이터 제공

**요청 사항**:

- 주소 분석 시, 해당 주소와 연결된 1-2홉 거래도 함께 제공
- 또는 "subgraph" 형태로 제공

**예시**:

```json
{
  "address": "0xABC...",
  "subgraph": {
    "nodes": ["0xABC", "0xDEF", "0xGHI", "0xJKL"],
    "edges": [
      {"from": "0xABC", "to": "0xDEF", ...},
      {"from": "0xDEF", "to": "0xGHI", ...},
      {"from": "0xGHI", "to": "0xJKL", ...}
    ]
  }
}
```

#### 옵션 B: 제한된 분석 (1-2홉만)

**구현**:

- 주소 A의 거래에서 직접 연결만 분석
- 1홉 경로만 탐지 (A → B)
- 2홉 이상은 백엔드 데이터 필요

**예시**:

```python
# B-201 룰 (제한적)
# A → B → C 경로를 찾으려면
# A의 거래에서 A → B는 찾을 수 있음
# 하지만 B → C는 A의 거래 히스토리에 없음
# 따라서 "부분 경로"만 탐지 가능
```

---

## 📋 결론 및 제안

### 현재 상황

✅ **가능한 것**:

- 주소 A의 직접 거래 분석 (A → B, B → A)
- 1홉 연결성 분석
- Fan-in/Fan-out 패턴 (A의 거래만으로도 가능)

❌ **불가능한 것**:

- 2홉 이상 경로 탐색 (A → B → C → D)
- 완전한 순환 탐지 (A → B → C → A)
- 멀리 떨어진 주소와의 연결성

### 제안

1. **백엔드와 협의**: 주소 분석 시 1-2홉 거래 데이터도 함께 제공 가능한지 확인
2. **제한적 구현**: 현재 데이터로 가능한 범위에서만 구현
3. **문서화**: B-201, B-202는 "확장 데이터 필요"로 표시

### 구체적 제안

**B-201, B-202 룰 구현 시**:

- 현재 데이터로는 **부분 경로만** 탐지 가능
- 완전한 경로 탐지는 **백엔드에서 확장 데이터 제공 필요**
- 또는 **별도 API 엔드포인트**로 그래프 분석 요청

---

## 💬 백엔드에 요청할 사항

**질문**:

1. 주소 분석 시, 해당 주소와 연결된 1-2홉 거래 데이터도 제공 가능한가?
2. 또는 "subgraph" 형태로 그래프 데이터를 제공할 수 있는가?
3. 별도의 "그래프 분석" API가 있는가?

**제안**:

- 주소 분석 API에 `include_subgraph: true` 옵션 추가
- 또는 별도 `/api/analyze/graph` 엔드포인트
